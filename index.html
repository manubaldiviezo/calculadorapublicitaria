<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Rentabilidad | Manu Meta Ads</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
    /* --- DISE√ëO VISUAL --- */
    :root {
        --primary: #FF9F1C;       /* Naranja Tech */
        --primary-dim: rgba(255, 159, 28, 0.1);
        --bg-body: #050505;       /* Negro Profundo */
        --bg-card: #111111;       /* Panel */
        --bg-input: #1A1A1A;
        --border: #2A2A2A;
        --text-main: #FFFFFF;
        --text-muted: #888888;
        
        --profit: #00E676;        /* Verde Rentable */
        --warn: #FFC400;          /* Amarillo Riesgo */
        --loss: #FF3D00;          /* Rojo P√©rdida */
    }

    * { box-sizing: border-box; outline: none; }

    body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family: 'Space Grotesk', sans-serif;
        margin: 0; padding: 0;
        font-size: 15px;
        line-height: 1.5;
        background-image: radial-gradient(circle at 50% 0%, #1a1205 0%, #000 60%);
        min-height: 100vh;
    }

    .app-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 40px 20px 100px;
    }

    /* HEADER */
    header {
        text-align: center;
        margin-bottom: 40px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 20px;
    }
    
    .brand {
        font-weight: 700;
        font-size: 1.5rem;
        letter-spacing: -0.5px;
        text-transform: uppercase;
        margin: 0;
    }
    .brand span { color: var(--primary); }
    .tagline { color: var(--text-muted); font-size: 0.85rem; margin-top: 5px; }

    /* TABS */
    .tabs {
        display: flex;
        background: var(--bg-card);
        padding: 6px;
        border-radius: 12px;
        border: 1px solid var(--border);
        margin-bottom: 30px;
    }
    
    .tab-btn {
        flex: 1;
        padding: 14px;
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        border-radius: 8px;
        transition: 0.3s;
    }
    
    .tab-btn.active {
        background: var(--primary);
        color: #000;
        box-shadow: 0 4px 20px rgba(255, 159, 28, 0.2);
    }

    /* GRID & CARDS */
    .grid { display: grid; gap: 20px; }
    .grid-2 { grid-template-columns: 1fr 1fr; }
    
    .card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 25px;
        height: 100%;
    }
    
    .card-head {
        margin-bottom: 20px;
        border-bottom: 1px solid var(--border);
        padding-bottom: 10px;
        color: var(--primary);
        font-weight: 700;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* INPUTS */
    .field { margin-bottom: 18px; }
    label { display: block; font-size: 0.75rem; color: var(--text-muted); margin-bottom: 6px; font-weight: 600; text-transform: uppercase; }
    
    .input-wrap { position: relative; }
    .symbol {
        position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
        color: #555; font-family: monospace; font-size: 1.1rem;
    }
    
    input, select {
        width: 100%; padding: 14px 14px 14px 35px;
        background: var(--bg-input); border: 1px solid var(--border);
        color: #fff; border-radius: 8px; font-size: 1rem;
        font-family: 'Space Grotesk', sans-serif; transition: 0.2s;
    }
    select { padding-left: 14px; cursor: pointer; }
    input:focus, select:focus { border-color: var(--primary); outline: none; }
    
    .hint { font-size: 0.7rem; color: #555; margin-top: 4px; display: flex; justify-content: space-between; }

    /* ACTION BUTTON */
    .btn-main {
        width: 100%; padding: 22px; margin-top: 20px;
        background: var(--primary); color: #000;
        font-weight: 700; font-size: 1.1rem; text-transform: uppercase;
        border: none; border-radius: 12px; cursor: pointer;
        transition: transform 0.1s;
    }
    .btn-main:active { transform: scale(0.98); }

    /* RESULTADOS */
    #results-panel { display: none; margin-top: 50px; animation: slideUp 0.5s ease; }
    @keyframes slideUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

    /* DIAGN√ìSTICO */
    .diagnosis-card {
        padding: 25px; border-radius: 12px; margin-bottom: 25px;
        background: rgba(255,255,255,0.03); border: 1px solid transparent;
        text-align: center;
    }
    .diag-title { font-size: 1.4rem; font-weight: 700; margin: 0 0 5px; }
    .diag-desc { color: var(--text-muted); font-size: 0.95rem; max-width: 600px; margin: 0 auto; }
    
    .status-ok { border-color: var(--profit); background: rgba(0, 230, 118, 0.05); }
    .status-ok .diag-title { color: var(--profit); }
    
    .status-warn { border-color: var(--warn); background: rgba(255, 196, 0, 0.05); }
    .status-warn .diag-title { color: var(--warn); }
    
    .status-bad { border-color: var(--loss); background: rgba(255, 61, 0, 0.05); }
    .status-bad .diag-title { color: var(--loss); }

    /* KPI DASHBOARD */
    .kpi-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
    
    .kpi-tile {
        background: var(--bg-card); border: 1px solid var(--border);
        border-radius: 12px; padding: 20px; text-align: center;
        display: flex; flex-direction: column; justify-content: center;
    }
    .kpi-tile.main {
        background: radial-gradient(circle at top, rgba(255,159,28,0.1), transparent);
        border-color: rgba(255,159,28,0.3);
    }
    
    .kpi-lbl { font-size: 0.7rem; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1px; }
    .kpi-val { font-size: 1.8rem; font-weight: 700; color: #fff; margin: 8px 0; }
    .kpi-val.xl { font-size: 2.4rem; color: var(--primary); }
    .kpi-sub { font-size: 0.75rem; color: #555; }

    /* EXPLICACI√ìN DETALLADA */
    .insights {
        background: #0f0f0f; border-left: 4px solid var(--text-muted);
        padding: 20px; border-radius: 0 8px 8px 0; margin-top: 30px;
        font-size: 0.9rem; color: #ccc;
    }
    .insights strong { color: #fff; }

    /* TABLE */
    .table-responsive { overflow-x: auto; border-radius: 12px; border: 1px solid var(--border); }
    table { width: 100%; border-collapse: collapse; min-width: 600px; background: var(--bg-card); }
    th { text-align: left; padding: 15px; background: #080808; color: var(--text-muted); font-size: 0.7rem; text-transform: uppercase; }
    td { padding: 15px; border-bottom: 1px solid #222; font-size: 0.9rem; }
    tr:last-child td { border: none; }
    
    footer { text-align: center; margin-top: 60px; color: #444; font-size: 0.8rem; }
    .hidden { display: none; }

    @media(max-width: 768px) {
        .grid-2 { grid-template-columns: 1fr; }
        .kpi-row { grid-template-columns: 1fr; }
    }
</style>
</head>
<body>

<div class="app-container">
    <header>
        <h1 class="brand">MANU <span>| META ADS</span></h1>
        <div class="tagline">CALCULADORA DE RENTABILIDAD & ESCALA</div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="setMode('leads')">üíº Servicios (Leads/WhatsApp)</button>
        <button class="tab-btn" onclick="setMode('ecom')">üõí E-Commerce (Venta Directa)</button>
    </div>

    <div class="grid grid-2">
        
        <div class="card">
            <div class="card-head">1. Estructura del Negocio</div>
            
            <div class="field">
                <label>Ticket Promedio (Valor de Venta)</label>
                <div class="input-wrap">
                    <span class="symbol">$</span>
                    <input type="number" id="ticket" placeholder="Ej: 50000">
                </div>
            </div>

            <div class="field">
                <label>Costo Variable (Prod + Env√≠o + Fees)</label>
                <div class="input-wrap">
                    <span class="symbol">$</span>
                    <input type="number" id="cogs" placeholder="Ej: 20000">
                </div>
                <div class="hint"><span>Costo directo de cada venta entregada.</span></div>
            </div>

            <div class="field">
                <label>Gastos Fijos Mensuales</label>
                <div class="input-wrap">
                    <span class="symbol">$</span>
                    <input type="number" id="fixed" placeholder="Ej: 500000">
                </div>
                <div class="hint"><span>Sueldos, luz, agencia, software.</span></div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">2. Proyecciones</div>
            
            <div class="field">
                <label>Meta de Facturaci√≥n Mensual</label>
                <div class="input-wrap">
                    <span class="symbol">$</span>
                    <input type="number" id="goal" placeholder="Ej: 5000000">
                </div>
            </div>

            <div id="inp-leads">
                <div class="field">
                    <label>Tasa de Cierre de Ventas (%)</label>
                    <input type="number" id="close_rate" placeholder="Ej: 10">
                    <div class="hint"><span>¬øDe 100 chats, cu√°ntos compran?</span></div>
                </div>
                <div class="field">
                    <label>Costo por Lead Actual (CPL)</label>
                    <div class="input-wrap">
                        <span class="symbol">$</span>
                        <input type="number" id="cpl" placeholder="(Opcional)">
                    </div>
                    <div class="hint"><span>Si no tienes, calcularemos uno ideal.</span></div>
                </div>
            </div>

            <div id="inp-ecom" class="hidden">
                <div class="field">
                    <label>Tasa de Conversi√≥n Web (%)</label>
                    <input type="number" id="conv_rate" placeholder="Ej: 1.5">
                </div>
                <div class="field">
                    <label>ROAS Actual (Retorno)</label>
                    <input type="number" id="roas" placeholder="(Opcional)">
                </div>
            </div>
        </div>
    </div>

    <button class="btn-main" onclick="calc()">Auditar Negocio üî•</button>

    <div id="results-panel">
        
        <div id="diag-box" class="diagnosis-card">
            <div class="diag-title" id="diag-title">...</div>
            <div class="diag-desc" id="diag-desc">...</div>
        </div>

        <div class="kpi-row">
            <div class="kpi-tile main">
                <div class="kpi-lbl">Inversi√≥n para Meta</div>
                <div class="kpi-val xl" id="res-inv">$0</div>
                <div class="kpi-sub">Presupuesto Sugerido</div>
            </div>
            <div class="kpi-tile">
                <div class="kpi-lbl" style="color:var(--loss)">Inversi√≥n M√≠nima</div>
                <div class="kpi-val" id="res-min" style="color:var(--loss)">$0</div>
                <div class="kpi-sub">Solo para cubrir costos (Sobrevivir)</div>
            </div>
            <div class="kpi-tile">
                <div class="kpi-lbl">M√©trica L√≠mite</div>
                <div class="kpi-val" id="res-limit">$0</div>
                <div class="kpi-sub" id="lbl-limit">CPL M√°ximo</div>
            </div>
        </div>

        <div class="kpi-row">
            <div class="kpi-tile">
                <div class="kpi-lbl">Volumen Necesario</div>
                <div class="kpi-val" id="res-vol">0</div>
                <div class="kpi-sub">Leads / Clics</div>
            </div>
            <div class="kpi-tile">
                <div class="kpi-lbl">M√©trica Objetivo</div>
                <div class="kpi-val" id="res-target" style="color:var(--primary)">0</div>
                <div class="kpi-sub">Para ser Rentable</div>
            </div>
            <div class="kpi-tile">
                <div class="kpi-lbl">Utilidad Neta Est.</div>
                <div class="kpi-val" id="res-net">$0</div>
                <div class="kpi-sub">Ganancia Real</div>
            </div>
        </div>

        <div class="card" style="margin-top:30px;">
            <div class="card-head">üìà Proyecciones & Sensibilidad</div>
            <div class="table-responsive">
                <table id="sc-table">
                    <thead>
                        <tr>
                            <th>Escenario</th>
                            <th>Eficiencia (CPL/ROAS)</th>
                            <th>Inversi√≥n</th>
                            <th>Neto Final</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="insights" id="insights-txt"></div>

    </div>

    <footer>
        <p>Herramienta Oficial | <strong>MANU META ADS</strong></p>
    </footer>
</div>

<script>
    // --- L√ìGICA DE NEGOCIO ---
    let MODE = 'leads';
    const $ = id => document.getElementById(id);
    const val = id => parseFloat($(id).value) || 0;
    const fmt = n => "$" + Math.floor(n).toLocaleString('es-ES');

    function setMode(m) {
        MODE = m;
        $('inp-leads').classList.toggle('hidden', m !== 'leads');
        $('inp-ecom').classList.toggle('hidden', m !== 'ecom');
        
        $('lbl-limit').innerText = m === 'leads' ? 'CPL M√°ximo (P√©rdida)' : 'CPA M√°ximo (P√©rdida)';
        
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        $('results-panel').style.display = 'none';
    }

    function calc() {
        const TICKET = val('ticket');
        const COGS = val('cogs');
        const FIXED = val('fixed');
        const GOAL = val('goal');

        if (!TICKET || !GOAL) return alert("Por favor ingresa Ticket y Meta.");
        
        // 1. Econom√≠a Unitaria
        const MARGIN_UNIT = TICKET - COGS;
        if (MARGIN_UNIT <= 0) return alert("ERROR: El costo variable supera el precio. No hay margen.");

        // 2. C√°lculos Base
        let salesNeeded = Math.ceil(GOAL / TICKET);
        
        let investTarget = 0;   // Inversi√≥n para Meta
        let investMin = 0;      // Inversi√≥n para Sobrevivir (Cubrir Fijos)
        let metricTarget = 0;   // CPL/ROAS Objetivo
        let metricLimit = 0;    // CPL/ROAS L√≠mite
        let volume = 0;

        if (MODE === 'leads') {
            let rate = val('close_rate') / 100 || 0.1;
            let userCpl = val('cpl');
            
            volume = Math.ceil(salesNeeded / rate);
            metricLimit = MARGIN_UNIT * rate; // CPL de Quiebre Operativo (Sin Fijos)
            
            // CPL Real L√≠mite (Considerando Fijos):
            // Ganancia Bruta = Fijos + Ads. -> Ads = Ganancia - Fijos.
            // Max Spend = (Sales * Margin) - Fixed.
            let maxSpendAvailable = (salesNeeded * MARGIN_UNIT) - FIXED;
            let absoluteMaxCpl = maxSpendAvailable / volume;

            // Target CPL: Si no hay usuario, usamos uno sano (40% del margen operativo)
            metricTarget = userCpl > 0 ? userCpl : (metricLimit * 0.4);
            
            investTarget = volume * metricTarget;
            
            // Inversi√≥n M√≠nima (Break Even Total): 
            // Ventas M√≠nimas = Fijos / (MarginUnit - TargetCPL_unit_cost)
            // Profit per Sale = MarginUnit - (TargetCPL / Rate)
            let profitPerSale = MARGIN_UNIT - (metricTarget / rate);
            
            if (profitPerSale > 0) {
                let minSales = Math.ceil(FIXED / profitPerSale);
                investMin = (minSales / rate) * metricTarget;
            } else {
                investMin = 999999999; // Imposible recuperar
            }

        } else { // ECOM
            let conv = val('conv_rate') / 100 || 0.015;
            let userRoas = val('roas');
            
            metricLimit = MARGIN_UNIT; // Max CPA Operativo
            let beRoasProduct = TICKET / MARGIN_UNIT; // ROAS Break Even Producto
            
            // Target ROAS para cubrir Fijos:
            // (Sales * Ticket) / ROAS = CostoAds.
            // (Sales * Margin) - CostoAds - Fixed = 0 -> CostoAds = Gross - Fixed.
            // TargetROAS_BE = GOAL / (Gross - Fixed).
            
            let grossTotal = salesNeeded * MARGIN_UNIT;
            let maxAdsBudget = grossTotal - FIXED;
            
            let beRoasTotal = maxAdsBudget > 0 ? (GOAL / maxAdsBudget) : 99; // ROAS para salir tablas totales
            
            // Target
            metricTarget = userRoas > 0 ? userRoas : Math.max(beRoasProduct * 2, beRoasTotal * 1.2);
            
            investTarget = GOAL / metricTarget;
            volume = Math.ceil(salesNeeded / conv); // Clicks
            
            // Min Invest to cover fixed
            // Profit per $1 ad spend = (ROAS * Margin%) - 1
            let marginPct = MARGIN_UNIT / TICKET;
            let profitPerDollar = (metricTarget * marginPct) - 1;
            
            if (profitPerDollar > 0) {
                investMin = FIXED / profitPerDollar;
            } else {
                investMin = 999999999;
            }
        }

        // 3. Resultados Finales
        let grossProfit = salesNeeded * MARGIN_UNIT;
        let netProfit = grossProfit - investTarget - FIXED;

        // 4. Diagn√≥stico
        let dBox = $('diag-box');
        let dTitle = $('diag-title');
        let dDesc = $('diag-desc');
        
        if (investMin > 99999999) {
            dBox.className = "diagnosis-card status-bad";
            dTitle.innerText = "ESTRUCTURA NO VIABLE";
            dDesc.innerText = "Con tus m√©tricas actuales, pierdes dinero con cada venta. Necesitas subir precio, bajar costos o mejorar conversi√≥n urgentemente.";
        } else if (netProfit < 0) {
            dBox.className = "diagnosis-card status-bad";
            dTitle.innerText = "P√âRDIDA PROYECTADA";
            dDesc.innerText = "Tu meta de facturaci√≥n no es suficiente para cubrir los costos fijos + publicidad. Necesitas vender m√°s volumen o reducir fijos.";
        } else if (netProfit < FIXED * 0.3) {
            dBox.className = "diagnosis-card status-warn";
            dTitle.innerText = "RIESGO ALTO (MARGEN AJUSTADO)";
            dDesc.innerText = "El negocio es rentable, pero la utilidad es baja comparada con el riesgo. Cualquier subida en costos de publicidad te har√° perder dinero.";
        } else {
            dBox.className = "diagnosis-card status-ok";
            dTitle.innerText = "LUZ VERDE: NEGOCIO ESCALABLE";
            dDesc.innerText = "Tienes una estructura s√≥lida. Tu margen soporta los costos y genera buena utilidad. ¬°Es momento de invertir!";
        }

        // Render KPIs
        $('res-inv').innerText = fmt(investTarget);
        $('res-min').innerText = investMin > 99999999 ? "IMPOSIBLE" : fmt(investMin);
        $('res-limit').innerText = fmt(metricLimit);
        $('res-vol').innerText = volume.toLocaleString();
        $('res-net').innerText = fmt(netProfit);
        $('res-net').style.color = netProfit > 0 ? "var(--profit)" : "var(--loss)";
        
        if(MODE === 'leads') {
            $('res-target').innerText = fmt(metricTarget) + " /lead";
        } else {
            $('res-target').innerText = metricTarget.toFixed(2) + "x ROAS";
        }

        // Tabla Escenarios
        const tbody = $('sc-table').querySelector('tbody');
        tbody.innerHTML = "";
        
        let scenarios = [];
        if(MODE==='leads'){
            scenarios = [
                {n:"Pesimista", m: metricTarget*1.3},
                {n:"Realista", m: metricTarget},
                {n:"Optimista", m: metricTarget*0.8}
            ];
        } else {
            scenarios = [
                {n:"M√≠nimo", m: metricTarget*0.8},
                {n:"Realista", m: metricTarget},
                {n:"Escala", m: metricTarget*1.2}
            ];
        }

        scenarios.forEach(sc => {
            let s_inv = 0;
            if(MODE==='leads') s_inv = (volume * sc.m);
            else s_inv = GOAL / sc.m;
            
            let s_net = grossProfit - s_inv - FIXED;
            let color = s_net > 0 ? 'var(--profit)' : 'var(--loss)';
            let txt = s_net > 0 ? 'RENTABLE' : 'P√âRDIDA';
            
            let lbl = MODE==='leads' ? fmt(sc.m) : sc.m.toFixed(2)+"x";

            tbody.innerHTML += `<tr>
                <td>${sc.n}</td>
                <td>${lbl}</td>
                <td>${fmt(s_inv)}</td>
                <td style="color:${color};font-weight:700">${fmt(s_net)}</td>
                <td style="color:${color};font-weight:700">${txt}</td>
            </tr>`;
        });

        // Insights Text
        let insights = `
            <strong>AN√ÅLISIS T√ÅCTICO:</strong><br>
            Para facturar <strong>${fmt(GOAL)}</strong>, necesitas invertir <strong>${fmt(investTarget)}</strong>.<br>
            Tu <strong>Punto de Supervivencia</strong> es <strong>${investMin > 999999 ? "Inalcanzable" : fmt(investMin)}</strong>; si inviertes menos que eso (y vendes proporcionalmente), tus costos fijos te comer√°n vivo.<br>
            Tu l√≠mite real es pagar <strong>${fmt(metricLimit)}</strong> por adquisici√≥n. Si te pasas, pierdes dinero unitario.
        `;
        $('insights-txt').innerHTML = insights;

        $('results-panel').style.display = 'block';
    }
</script>

</body>
</html>
